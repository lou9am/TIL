# 2과목 SQL 기본
(유선배 SQL 개발자, SQL 자격검정 실전문제 문제집을 바탕으로 정리)  
<br>

## SELECT문의 논리적 수행 순서
SELECT - 5  
FROM - 1  
WHERE - 2  
GROUP BY - 3  
HAVING - 4  
ORDER BY - 6  

<br>

## SELECT 문

1. SELECT
- 컬럼 명시 없이 * 사용 : 전체 컬럼 조회
- WHERE 없으면 테이블 전체 Row 조회

2. 산술 연산자
- (), *, /, +, -
- 사칙연산과 동일하게 () 먼저, 그 다음 곱셈과 나눗셈, 마지막으로 덧셈 뺄셈 순으로 우선순위를 갖는다.

3. 합성 연산자
|| : 문자와 문자를 연결함

### 함수
([]는 선택사항이다.)

1. 문자 함수

- `CHR(ASCII 코드)` : 아스키 코드를 입력했을 때 매핑되는 문자 반환, (MSSQL의 경우 `CHAR`)
- `LOWER(문자열)` : 문자열 소문자 변환
- `UPPER(문자열)` : 문자열 대문자 변환
- `LTRIM(문자열 [,특정 문자])` : 문자열의 왼쪽 공백 제거
- `RTRIM(문자열 [,특정 문자])` : 문자열의 오른쪽 공백 제거
- `TRIM([위치][특정 문자][FROM]문자열)` : 옵션이 없을 경우 문자열의 양쪽 공백 제거, 옵션은 LEADING, TRAILING, BOTH가 있으며 LTRIM, RTRIM과 달리 특정 문자는 한 글자만 지정할 수 있다.
- `SUBSTR(문자열, 시작점 [,길이])` : 문자열 잘라서 반환. 길이 명시 안 됐을 경우 문자열의 시작부터 끝까지 반환
- `LENGTH(문자열)` : 문자열 길이 반환 (MSSQL은 `LEN`)
- `REPLACE(문자열, 변경 전 문자열 [,변경 후 문자열])` : 변경 전 문자열을 찾아 변경 후 문자열로 바꿈. **변경 후 문자열을 명시하지 않을 경우 변경 전 문자열을 제거**한다.

2. 숫자 함수

- `ABS(수)` : 절댓값 반환
- `SIGN(수)` : 부호 반환. 양수는 1, 음수는 -1, 0은 0
- `ROUND(수 [,자릿수])` : 자릿수 명시하지 않았을 경우 기본값은 0. 반올림된 정수로 반환. 자릿수가 음수일 경우 지정된 정수부를 반올림하여 반환.
- `TRUNC(수 [,자릿수])` : 수를 지정된 소수점 자릿수까지 버림하여 반환. 자릿수 명시하지 않았을 경우 기본값 0. 자릿수가 음수일 경우 지정된 정수부에서 버림하여 반환
- `CEIL(수)` : 소수점 이하의 수를 올림한 정수 반환 (MSSQL은 CEILING)
- `FLOOR(수)` : 소수점 이하의 수를 버림한 정수 반환
- `MOD(수1, 수2)` : 수1을 수2로 나눈 나머지 반환

3. 날짜 함수

- `SYSDATE` : 현재의 연, 월, 일, 시, 분, 초 반환 (MSSQL은 `GETDATE()`)
- `EXTRACT(특정 단위 FROM 날짜 데이터)` : 날짜 데이터에서 특정 단위만 출력해 반환 (MSSQL은 `DATEPART`)
- `ADD_MONTHS(날짜 데이터, 특정 개월 수)` : 날짜 데이터에서 특정 개월 수를 더한 날짜를 반환. **일자가 존재하지 않을 경우 해당 월의 마지막 일자 반환**

4. 변환 함수

- `TO_NUMBER(문자열)` : 문자열을 숫자형으로 변환. 문자열 자리에 숫자가 아닌 'abc'같은 문자 입력시 에러 발생
- `TO_CHAR(수 or 날짜 [, 포맷])` : 수나 날짜형의 데이터를 포맷 형식의 문자형으로 변환
- `TO_DATE(문자열, 포맷)` : 포맷 형식의 문자형의 데이터를 날짜형으로 변환

|포맷 표현|의미|포맷 표현|의미|
|---|--|---|--|
|YYYY|년|HH|시(12)|
|MM|월|HH24|시(24)|
|DD|일|MI|분|
|||SS|초|

5. NULL 관련 함수

- `NVL(인수1, 인수2)` : 인수1의 값이 NULL일 경우 인수2 반환, NULL이 아닐 경우 인수1 반환 (MSSQL은 `ISNULL(인수1, 인수2)`)
- `NULLIF(인수1, 인수2)` : 인수1과 인수2가 **같으면 NULL 반환, 같지 않으면 인수1 반환**
- `COALESCE(인수1, 인수2, 인수3...)` : NULL이 아닌 최초의 인수 반환

6. CASE
- `WHEN ~ THEN`으로 이루어지며 `ELSE`문은 생략 가능하다. CASE문 끝에는 `END`로 닫는다.
- Oracle의 `DECODE` 함수가 같은 기능을 한다.


예)
`DECODE(SUBWAY_LINE, '1', 'BLUE', '2', 'GREEN', '3', 'ORANGE' [, 'GRAY'])`

<br>

## WHERE문
- `INSERT`를 제외한 DML문을 수행할 때 원하는 데이터만 골라 수행할 수 있도록 해주는 구문

1. 비교 연산자

|연산자|의미|
|---|--|
|=|같음|
|<|작음|
|<=|작거나 같음|
|>|큼|
|>=|크거나 같음|

2. 부정 비교 연산자

|연산자|의미|예시|
|---|--|--|
|!=|같지 않음|
|^=|같지 않음|
|<>|같지 않음|where col <> 10|
|not 컬럼명 = |같지 않음|
|not 컬럼명 >|크지 않음|

3. SQL 연산자

|연산자|의미|
|---|--|
|BETWEEN A AND B|A와 B 사이(A, B 포함)|
|LIKE '비교 문자열'|비교 문자열을 포함|
|IN (LIST)|LIST 중 하나와 일치|
|IS NULL|NULL 값|

4. 부정 SQL 연산자

|연산자|의미|
|---|--|
|NOT BETWEEN A AND B|A와 B 사이가 아님(A, B 미포함)|
|NOT IN (LIST)|LIST 중 일치하는 것이 없음|
|NOT IS NULL|NULL 값이 아님|

5. 논리 연산자
SQL에 명시된 순서와는 관계없이 **( ) -> NOT -> AND -> OR** 순으로 처리된다.

<br>

## GROUP BY, HAVING 절
1. GROUP BY
- by 뒤에 오는 컬럼을 기준으로 데이터를 그룹별로 묶는다.
- 이때, 컬럼은 하나 이상이 될 수 있다.

2. 집계 함수

|||
|---|--|
|COUNT(*)|전체 Row를 Count하여 반환|
|COUNT(컬럼)|컬럼값이 Null인 Row를 제외하고 Count하여 반환|
|COUNT(DISTINCT 컬럼)|컬럼값이 Null이 아닌 Row에서 중복을 제거한 Count를 반환|
|SUM(컬럼)|컬럼값들의 합계 반환|
|AVG(컬럼)|컬럼값들의 평균 반환|
|MIN(컬럼)|컬럼값들의 최솟값 반환|
|MAX(컬럼)|컬럼값들의 최댓값 반환|


3. HAVING
- 데이터를 그룹핑한 후 특정 그룹을 골라낼 때 사용
- HAVING 절은 SELECT 절보다 먼저 수행되기 때문에 SELECT 절에서 정의한 ALIAS를 사용할 수 없다.
- HAVING 절은 논리적으로 SELECT 절 전에 수행되기 때문에 SELECT 절에 명시되지 않은 집계 함수로도 조건을 부여하는 것이 가능하다.
- 이때, WHERE 절에 사용해도 되는 조건까지 HAVING 절로 쓰지 않도록 주의한다. GROUP BY는 비교적 많은 비용이 드는 작업이므로 수행 전에 데이터량을 최소로 줄여놓는 것이 바람직하기 때문이다.

<br>

## ORDER BY 절
- SELECT문에서 논리적으로 **맨 마지막**으로 수행된다.
- ORDER BY 절을 따로 명시하지 않으면 데이터는 임의의 순서대로 출력된다.
- ORDER BY 절 뒤에는 정렬의 기준이 되는 컬럼이 오며, 컬럼은 하나 이상일 수 있다.
- 컬럼에 ASC(오름차순), DESC(내림차순)와 같은 옵션을 붙일 수 잇으며 옵션 생략시 ASC가 기본값이다.
- 정렬의 기준이 되는 컬럼에 NULL 데이터가 포함되어 있을 경우, 데이터베이스 종류에 따라 정렬의 위치가 달라진다. Oracle의 경우 NULL을 최댓값으로 취급하며, MSSQL은 반대이다. 만약, 순서를 변경하고 싶다면 NULLS FIRST, NULLS LAST 옵션을 사용하면 된다.

<br>

## JOIN
1. EQUI JOIN
- '=' 조건으로 JOIN

2. Non EQUI JOIN
- '=' 조건이 아닌 다른 조건(BETWEEN, >, >=, <, <=)으로 JOIN

3. 3개 이상의 TABLE JOIN

4. OUTER JOIN
- INNER JOIN, LEFT OUTER JOIN, RIGHT OUTER JOIN
- JOIN 조건에 만족하지 않는 행들도 출력되는 형태. Oracle에서는 모든 행이 출력되는 테이블의 반대편 테이블의 옆에 (+) 기호를 붙여 작성한다.

<br>

## STANDARD JOIN (표준 조인)
- 벤더마다 SQL 문법에 차이가 너무 클 경우 호환성과 효율성이 떨어진다. 이러한 문제를 해결하기 위해 표준 ANSI SQL중 하나로 ANIS JOIN을 사용한다.

1. INNER JOIN
- `ON`절을 사용해 JOIN 조건을 작성한다.

2. OUTER JOIN
- LEFT OUTER JOIN, RIGHT OUTER JOIN, FULL OUTER JOIN이 있으며 JOIN되는 데이터가 없는 row들은 컬럼 값이 NULL로 출력된다.

3. NATURAL JOIN
- 같은 이름을 가진 컬럼들이 모두 동일한 데이터를 가지고 있을 경우 JOIN. (MSSQL에서는 지원하지 않는다.)

4. CROSS JOIN (Cartesian Product)
- JOIN 조건이 없는 경우, 조합할 수 있는 모든 경우를 출력하는 방식
