# 3장 소프트웨어 개발 단계와 테스트
(테스트 레벨에 따른 테스트 방법에 대한 내용)

## 단위 테스트
- 개별적인 모듈(또는 단위)을 독립적으로 테스트
- 단위 테스트의 주요 목적 중 하나는 리그레션 테스트이다.
- **모듈을 단독으로 실행할 수 있는 환경이 필요**하다.
- 테스트 환경은 테스트 베드(Test bed)라고도 한다. 테스트 환경의 주요 요소로 `테스트 드라이버`와 `테스트 스텁`이 있다.
- 단위 0을 대상으로 테스트를 수행하는 경우, 다른 컴포넌트에 의존하지 않는 방식으로 테스트가 수행되므로 단위 1을 호출하는 대신에 이에 대한 스텁을 사용한다.

### 모의 객체 생성 프레임워크
- 객체 지향 프로그램에서는 단위 테스트를 수행할 때 테스트 되는 메소드가 다른 클래스의 객체에 의존할 수 있다. 따라서 독립적인 단위 테스트를 위해서는 절차 지향적 프로그래밍에서 스텁과 같은 개념이 필요하다.
- `모의(Mock) 객체`는 **스텁의 객체 지향 버전**이라고 할 수 있다.
- 모의 객체는 개발자가 처음부터 수작업으로 만들거나 모의 객체 생성 프레임워크를 이용하여 만들 수 있다.
- 모의 객체는 다음과 같이 분류한다.

1. `더미(dummy) 개체` : **객체만 필요하고 객체의 기능까지는 필요하지 않은 경우** 사용. 더미 객체의 메소드가 호출되면 정상 동작은 수행하지 않고 예외를 던진다.
2. `테스트 스텁(Stub)` : 더미 객체에 단순한 기능성을 작성하여 추가객체의 특정 상태를 가정해서 특정한 값을 리턴하거나 특정한 메시지를 출력하게 한다.
3. `테스트 스파이(Spy)` : 테스트 대상 클래스와 협력하는 클래스로 가는 출력을 검증하는데 사용. 실행이 끝난 후 정상 호출되었는지 검사한다.
4. `가짜(Fake) 객체` : 실제 협력 클래스가 구현되지 않았거나 너무 느리거나 테스트 환경에서는 사용할 수 없을 때 실제 협력 클래스의 기능 중 전체나 일부를 훨씬 단순하게 구현한 객체.


### FIRST 원칙
단위 테스트를 잘 수행하기 위한 5가지 원칙
1. Fast : 데이터베이스나 네트워크처럼 외부 자원에 의존하는 경우 테스트 수행 시간이 길어질 가능성이 크다. 이 경우에는 모의 객체 생성 프레임워크를 이용하여 테스크 시간을 단축하는 것이 좋다.
2. Isolated : 다른 단위 테스트에 의존하지 않도록 한다. 한 단위 테스트가 다른 단위 테스트의 수행 결과에 의존할 경우, 테스트 실행 순서에 따라 다른 결과가 나올 것이다.
3. Repeatable : 테스트를 몇 번 실행해도 동일한 결과가 나오도록 해야 한다.
4. Self-Validating : 사람의 개입 없이 테스트가 통과되었는지 알 수 있도록 작성해야 한다.
5. Timely : 제때 수행되어야 한다. 제때란, 테스트 대상이 되는 코드가 작성되는 시점을 의미하며, TDD에서는 코드 작성 바로 전이다.


## 통합 테스트
- 유닛들을 통합하는 과정에서 수행되는 테스트이다.
- 유닛들 간의 상호 연동이 제대로 수행되는지 검사.
- **연결의 정확성에만 초점**을 두기도 하고, 두 유닛들의 **기능적인 측면**에 초점을 두기도 한다.
- 상호작용에 초점을 둘 경우, 두 유닛들 간에 전송, 수신된 데이터를 중심으로 본다.
- 임베디드 소프트웨어처럼 로그를 기록하기에 메모리 공간이 제한적인 경우, 실제 전달되는 데이터 전체 로그를 남기는 대신에 `핑거 프린트(Finger print)`를 사용해서 **데이터의 변경 여부만을 판단**하기도 한다.


### 점진적 통합
- 통합 대상 유닛이 많은 경우, 전체 유닛을 한 번에 통합하여 테스트하는 방법을 `빅뱅 방식`이라고 부른다.
- 빅뱅 방식은 오동작이 확인되었을 때 어떤 유닛이 결함을 가졌는지 판단하기 어렵다.
- 이런 경우, 적은 수의 유닛을 차례로 통합하는 `점진적 방식`을 적용하는 것이 효과적이다.
- 점진적 방식은 **오작동의 원인이 되는 유닛을 찾기 쉬운** 반면 **테스트 드라이버 및 스텁을 여러 번 개발해야 한다**는 단점이 있다.
- 호출 관계의 상하 순서에 따라 1) 상향식 통합 2) 하향식 통합 3) 샌드위치 통합 방식이 있다.

1. `상향식 통합 테스트`
- 하위 유닛을 충분히 테스트할 수 있다.
- 일반적으로 하위에 있는 유닛은 시스템이 제공하는 서비스에 필요한 공통적인 기능을 제공한다. 따라서 빈번하게 사용된다고 간주할 수 있으며, 그만큼 더 빈번하게 테스트할 수 있다.
- 하향식 통합에서 필요한 테스트 스텁을 제공하는 비용이 들지 않는다.

2. `하향식 통합 테스트`
- 가장 상위에 있는 유닛을 테스트하기 위해 하위 유닛을 테스트 스텁으로 대치한 후 깊이 우선 방식이나 너비 우선 방식으로 테스트 스텁을 한 번에 하나씩 실제 유닛으로 대치한다.
- 이 경우 테스트 스텁이 실제 모듈로 대치되는 시스템 변경이 발생했으므로 리그레션 테스트를 수행한다.
- 상위 컴포넌트의 결함을 빠르게 발견할 수 있다.
- 테스트 스텁이 필요하므로 스텁 구현 비용이 많이 드는 경우에 비효율적이다.


## 시스템 테스트 및 인수 테스트
- 인수 테스트의 유형에는 `알파 테스트`와 `베타 테스트`가 있다.
- 알파 테스트는 선택된 사용자가 개발자 환경에서 통제된 상태로 수행하는 반면, 베타 테스트는 일정 수의 사용자에게 소프트웨어를 사용하게 하고 피드백을 받는다.

## 리그레션 테스트
- **유지보수 단계**에서도 수정 후 변경이 올바르게 되었는지 검사를 한다.
- 유지보수 단계에서 이루어지는 수정은 다음과 같다.

1. 결함 수정 작업
2. 기능 보강 작업
3. 적응 작업
4. 예방 작업

- 보통 유지보수 단계에서의 리그레션 테스트는 **개발 단계에서 사용한 테스트 케이스를 이용**한다.
- 가장 중요하게 고려해야할 점은 테스트 케이스의 **규모**이다.
- 리그레션 테스트 방법은 다음과 같이 구분할 수 있다.

1. `Retest-All`
- 기존에 개발된 모든 테스트 케이스를 사용하지만 너무 많은 시간과 자원이 필요하다.
2. `선택적 리그레션 테스트`
- 기존의 테스트 케이스 중 일부만 선정
3. `테스트 최소화`
- 중복된 테스트 케이스를 제거하여 테스트 케이스 개수를 줄인다.
4. `테스트 우선 순위화`
- 우선순위가 높은 테스트 케이스만을 활용

### APFD(Average Percentage of Faults Detected)
- 테스트 케이스 우선순위의 효과성을 평가하기 위한 척도. (0~100)
- 테스트 케이스의 실행 수 대비 검출된 결함의 비율을 측정
- **높을수록 많은 결함을 빨리 찾았다는 의미**이다.
- 테스트 케이스의 실행 순서에 따라 APFD는 큰 차이를 보인다.
